{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\batyayur\\\\OneDrive - AMDOCS\\\\Protected Folders\\\\Documents\\\\BattyDocument\\\\work\\\\MoonActiveProject\\\\ui\\\\src\\\\components\\\\promotionTable\\\\promotionTable.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useReducer, useEffect } from \"react\";\nimport Paper from \"@material-ui/core/Paper\";\nimport { DataTypeProvider, RowDetailState, SelectionState, VirtualTableState } from \"@devexpress/dx-react-grid\";\nimport { Grid, VirtualTable, TableHeaderRow, TableSelection, TableEditRow } from \"@devexpress/dx-react-grid-material-ui\";\nimport axios from \"axios\";\nimport reducer from \"../../actions/promotionReducer\";\nimport { columnExtensions, promotionsTableColumns } from \"../../common/columnSchema\";\nimport { MenuItem, Select } from \"@material-ui/core\";\nimport { addPromotion, deletePromotionById, updatePromotion, getPromotionById } from \"../../actions/promotionApiActions\";\nimport * as _ from \"lodash\";\nimport PromotionEditModal from \"../promotionEditModal/promotionEditModal\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VIRTUAL_PAGE_SIZE = 200;\nconst MAX_ROWS = 10000;\nconst URL = \"http://localhost:4000\";\n\nconst getRowId = row => row._id;\n\nconst buildQueryString = (skip, take) => `${URL}/getAllPromotions?skip=${skip}&take=${take}`;\n\nconst initialState = {\n  rows: [],\n  skip: 0,\n  requestedSkip: 0,\n  take: VIRTUAL_PAGE_SIZE * 2,\n  totalCount: 0,\n  loading: false,\n  lastQuery: \"\"\n};\n\nconst DateFormatter = ({\n  value\n}) => value.split(\"T\")[0];\n\n_c = DateFormatter;\n\nconst DateTypeProvider = props => /*#__PURE__*/_jsxDEV(DataTypeProvider, {\n  formatterComponent: DateFormatter,\n  ...props\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 53,\n  columnNumber: 3\n}, this);\n\n_c2 = DateTypeProvider;\nexport default function PromotionTable() {\n  _s();\n\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const columns = promotionsTableColumns;\n  const [tableColumnExtensions] = useState(columnExtensions);\n  const [selection, setSelection] = useState([]);\n  const [dateColumns] = useState([\"promotionStartDate\", \"promotionEndDate\"]);\n  const [openEditModal, setOpenEditModal] = useState(false);\n  const [editPromotion, setEditPromotion] = useState();\n  const editingStateColumnExtensions = [{\n    columnName: \"Action\",\n    editingEnabled: false\n  }];\n\n  const getRemoteRows = (requestedSkip, take) => {\n    dispatch({\n      type: \"START_LOADING\",\n      payload: {\n        requestedSkip,\n        take\n      }\n    });\n  };\n\n  const handleCloseEditModal = () => {\n    setOpenEditModal(false);\n    setEditPromotion(null);\n    setSelection([]);\n  };\n\n  const handlePromotionEdit = promotionId => {\n    getPromotionById(promotionId).then(response => {\n      let editPromotion = response.data.promotion;\n      setEditPromotion(editPromotion);\n      setOpenEditModal(true);\n      console.log(response.data.promotion);\n    });\n  };\n\n  const handleUpdatePromotion = updatePro => {\n    updatePromotion(updatePro).then(response => {\n      console.clear();\n      console.log(response.data.promotion);\n      console.log(rows);\n      setSelection([]);\n      setOpenEditModal(false);\n      setEditPromotion(null);\n    });\n  };\n\n  const handlePromotionDelete = promotionId => {\n    deletePromotionById(promotionId).then(() => {\n      setSelection([]);\n      const updatedRows = rows.filter(function (row) {\n        return row._id !== promotionId;\n      });\n      dispatch({\n        type: \"UPDATE_ROWS\",\n        payload: {\n          rows: updatedRows\n        }\n      });\n    }).catch(() => dispatch({\n      type: \"REQUEST_ERROR\"\n    }));\n  };\n\n  const handlePromotionDuplicate = promotionId => {\n    let duplicatePromotion = _.find(rows, {\n      _id: promotionId\n    });\n\n    addPromotion(duplicatePromotion).then(response => {\n      console.log(response.data.promotion);\n      setSelection([]); //rows.splice(0, 0, response.data.promotion);\n\n      const updateRows = rows;\n      updateRows.pop();\n      updateRows.unshift(response.data.promotion);\n      dispatch({\n        type: \"UPDATE_ROWS\",\n        payload: {\n          rows: updateRows\n        }\n      });\n    }).catch(() => dispatch({\n      type: \"REQUEST_ERROR\"\n    }));\n  };\n\n  const onActionChange = event => {};\n\n  const commitChanges = ({\n    added,\n    changed,\n    deleted\n  }) => {\n    const {\n      requestedSkip,\n      take,\n      totalCount\n    } = state;\n\n    if (added) {}\n\n    if (changed) {\n      const currentRow = rows.find(row => changed[row._id]);\n      const editedRow = { ...currentRow,\n        ...changed[currentRow._id]\n      };\n      let changedRows = rows.map(row => changed[row._id] ? { ...row,\n        ...changed[row._id]\n      } : row);\n      dispatch({\n        type: \"UPDATE_ROWS\",\n        payload: {\n          skip: requestedSkip,\n          rows: changedRows\n        }\n      });\n      PromotionDataService.update(editedRow._id, editedRow);\n    }\n  };\n\n  const SelectActionType = () => /*#__PURE__*/_jsxDEV(Select, {\n    onChange: onActionChange,\n    style: {\n      width: \"100%\"\n    },\n    disabled: selection.length !== 1,\n    children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n      value: \"edit\",\n      onClick: () => handlePromotionEdit(selection[0]),\n      children: \"Edit\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n      value: \"delete\",\n      onClick: () => handlePromotionDelete(selection[0]),\n      children: \"Delete\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n      value: \"duplicate\",\n      onClick: () => handlePromotionDuplicate(selection[0]),\n      children: \"Duplicate\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n\n  const SelectTypeProvider = props => {\n    return /*#__PURE__*/_jsxDEV(DataTypeProvider, {\n      disabled: selection.length !== 1,\n      formatterComponent: SelectActionType,\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }, this);\n  };\n\n  const loadData = () => {\n    const {\n      requestedSkip,\n      take,\n      lastQuery,\n      loading\n    } = state;\n    const query = buildQueryString(requestedSkip, take);\n\n    if (query !== lastQuery && !loading) {\n      dispatch({\n        type: \"FETCH_INIT\"\n      });\n      axios.get(query).then(response => {\n        console.log(response.data.promotions);\n        dispatch({\n          type: \"UPDATE_ROWS\",\n          payload: {\n            skip: requestedSkip,\n            rows: response.data.promotions,\n            totalCount: MAX_ROWS\n          }\n        });\n      }).catch(() => dispatch({\n        type: \"REQUEST_ERROR\"\n      }));\n      dispatch({\n        type: \"UPDATE_QUERY\",\n        payload: query\n      });\n    }\n  };\n\n  useEffect(() => loadData());\n  const {\n    rows,\n    skip,\n    totalCount,\n    loading\n  } = state;\n  return /*#__PURE__*/_jsxDEV(Paper, {\n    children: /*#__PURE__*/_jsxDEV(Grid, {\n      rows: rows,\n      columns: columns,\n      getRowId: getRowId,\n      children: [/*#__PURE__*/_jsxDEV(SelectionState, {\n        selection: selection,\n        onSelectionChange: setSelection\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(EditingState, {\n        onCommitChanges: commitChanges,\n        columnExtensions: editingStateColumnExtensions\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SelectTypeProvider, {\n        for: [\"Action\"],\n        rowComponent: true,\n        row: RowDetailState\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DateTypeProvider, {\n        for: dateColumns\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(VirtualTableState, {\n        infiniteScrolling: true,\n        loading: loading,\n        totalRowCount: totalCount,\n        pageSize: VIRTUAL_PAGE_SIZE,\n        skip: skip,\n        getRows: getRemoteRows\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(VirtualTable, {\n        columnExtensions: tableColumnExtensions\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(TableSelection, {\n        highlightRow: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(TableHeaderRow, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this), editPromotion && /*#__PURE__*/_jsxDEV(PromotionEditModal, {\n        promotion: editPromotion,\n        handleCloseEditModal: handleCloseEditModal,\n        open: openEditModal,\n        handleUpdatePromotion: handleUpdatePromotion\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(TableEditRow, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(TableEditColumn, {\n        showAddCommand: true,\n        showEditCommand: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 221,\n    columnNumber: 5\n  }, this);\n}\n\n_s(PromotionTable, \"Yhq4Eotymd1S5q7J5L6aFKR4pVk=\");\n\n_c3 = PromotionTable;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"DateFormatter\");\n$RefreshReg$(_c2, \"DateTypeProvider\");\n$RefreshReg$(_c3, \"PromotionTable\");","map":{"version":3,"sources":["C:/Users/batyayur/OneDrive - AMDOCS/Protected Folders/Documents/BattyDocument/work/MoonActiveProject/ui/src/components/promotionTable/promotionTable.tsx"],"names":["React","useState","useReducer","useEffect","Paper","DataTypeProvider","RowDetailState","SelectionState","VirtualTableState","Grid","VirtualTable","TableHeaderRow","TableSelection","TableEditRow","axios","reducer","columnExtensions","promotionsTableColumns","MenuItem","Select","addPromotion","deletePromotionById","updatePromotion","getPromotionById","_","PromotionEditModal","VIRTUAL_PAGE_SIZE","MAX_ROWS","URL","getRowId","row","_id","buildQueryString","skip","take","initialState","rows","requestedSkip","totalCount","loading","lastQuery","DateFormatter","value","split","DateTypeProvider","props","PromotionTable","state","dispatch","columns","tableColumnExtensions","selection","setSelection","dateColumns","openEditModal","setOpenEditModal","editPromotion","setEditPromotion","editingStateColumnExtensions","columnName","editingEnabled","getRemoteRows","type","payload","handleCloseEditModal","handlePromotionEdit","promotionId","then","response","data","promotion","console","log","handleUpdatePromotion","updatePro","clear","handlePromotionDelete","updatedRows","filter","catch","handlePromotionDuplicate","duplicatePromotion","find","updateRows","pop","unshift","onActionChange","event","commitChanges","added","changed","deleted","currentRow","editedRow","changedRows","map","PromotionDataService","update","SelectActionType","width","length","SelectTypeProvider","loadData","query","get","promotions"],"mappings":"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","sourcesContent":["import React, { useState, useReducer, useEffect } from \"react\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport {\r\n  Column,\r\n  DataTypeProvider,\r\n  DataTypeProviderProps,\r\n  RowDetailState,\r\n  SelectionState,\r\n  VirtualTableState,\r\n} from \"@devexpress/dx-react-grid\";\r\nimport {\r\n  Grid,\r\n  VirtualTable,\r\n  TableHeaderRow,\r\n  TableSelection,\r\n  TableEditRow,\r\n} from \"@devexpress/dx-react-grid-material-ui\";\r\nimport axios, { AxiosResponse } from \"axios\";\r\nimport reducer from \"../../actions/promotionReducer\";\r\nimport {\r\n  columnExtensions,\r\n  promotionsTableColumns,\r\n} from \"../../common/columnSchema\";\r\nimport { MenuItem, Select } from \"@material-ui/core\";\r\nimport {\r\n  addPromotion,\r\n  deletePromotionById,\r\n  updatePromotion,\r\n  getPromotionById,\r\n} from \"../../actions/promotionApiActions\";\r\nimport * as _ from \"lodash\";\r\nimport PromotionEditModal from \"../promotionEditModal/promotionEditModal\";\r\nconst VIRTUAL_PAGE_SIZE = 200;\r\nconst MAX_ROWS = 10000;\r\nconst URL = \"http://localhost:4000\";\r\nconst getRowId = (row: any) => row._id;\r\nconst buildQueryString = (skip: any, take: any) =>\r\n  `${URL}/getAllPromotions?skip=${skip}&take=${take}`;\r\n\r\nconst initialState = {\r\n  rows: [],\r\n  skip: 0,\r\n  requestedSkip: 0,\r\n  take: VIRTUAL_PAGE_SIZE * 2,\r\n  totalCount: 0,\r\n  loading: false,\r\n  lastQuery: \"\",\r\n};\r\n\r\nconst DateFormatter = ({ value }: { value: any }) => value.split(\"T\")[0];\r\n\r\nconst DateTypeProvider = (props: any) => (\r\n  <DataTypeProvider formatterComponent={DateFormatter} {...props} />\r\n);\r\n\r\nexport default function PromotionTable() {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n  const columns: Column[] = promotionsTableColumns;\r\n  const [tableColumnExtensions] = useState(columnExtensions);\r\n  const [selection, setSelection] = useState<any | null>([]);\r\n  const [dateColumns] = useState([\"promotionStartDate\", \"promotionEndDate\"]);\r\n  const [openEditModal, setOpenEditModal] = useState(false);\r\n  const [editPromotion, setEditPromotion] = useState<any | null>();\r\n  const editingStateColumnExtensions = [\r\n    { columnName: \"Action\", editingEnabled: false },\r\n  ];\r\n\r\n  const getRemoteRows = (requestedSkip: any, take: any) => {\r\n    dispatch({ type: \"START_LOADING\", payload: { requestedSkip, take } });\r\n  };\r\n\r\n  const handleCloseEditModal = () => {\r\n    setOpenEditModal(false);\r\n    setEditPromotion(null);\r\n    setSelection([]);\r\n  };\r\n\r\n  const handlePromotionEdit = (promotionId: string) => {\r\n    getPromotionById(promotionId).then((response) => {\r\n      let editPromotion: IPromotion | undefined = response.data.promotion;\r\n      setEditPromotion(editPromotion);\r\n      setOpenEditModal(true);\r\n\r\n      console.log(response.data.promotion);\r\n    });\r\n  };\r\n\r\n  const handleUpdatePromotion = (updatePro: IPromotion) => {\r\n    updatePromotion(updatePro).then((response) => {\r\n      console.clear();\r\n      console.log(response.data.promotion);\r\n      console.log(rows);\r\n      setSelection([]);\r\n      setOpenEditModal(false);\r\n      setEditPromotion(null);\r\n    });\r\n  };\r\n\r\n  const handlePromotionDelete = (promotionId: string) => {\r\n    deletePromotionById(promotionId)\r\n      .then(() => {\r\n        setSelection([]);\r\n        const updatedRows = rows.filter(function (row: any) {\r\n          return row._id !== promotionId;\r\n        });\r\n        dispatch({\r\n          type: \"UPDATE_ROWS\",\r\n          payload: {\r\n            rows: updatedRows,\r\n          },\r\n        });\r\n      })\r\n      .catch(() => dispatch({ type: \"REQUEST_ERROR\" }));\r\n  };\r\n\r\n  const handlePromotionDuplicate = (promotionId: string) => {\r\n    let duplicatePromotion = _.find(rows, { _id: promotionId });\r\n    addPromotion(duplicatePromotion)\r\n      .then((response) => {\r\n        console.log(response.data.promotion);\r\n        setSelection([]);\r\n\r\n        //rows.splice(0, 0, response.data.promotion);\r\n        const updateRows = rows;\r\n        updateRows.pop();\r\n        updateRows.unshift(response.data.promotion);\r\n        dispatch({\r\n          type: \"UPDATE_ROWS\",\r\n          payload: {\r\n            rows: updateRows,\r\n          },\r\n        });\r\n      })\r\n      .catch(() => dispatch({ type: \"REQUEST_ERROR\" }));\r\n  };\r\n\r\n  const onActionChange = (event: any) => {};\r\n  const commitChanges = ({ added, changed, deleted }:any) => {\r\n    const { requestedSkip, take, totalCount } = state;\r\n    if (added) {\r\n\r\n    }\r\n    if (changed) {\r\n      const currentRow = rows.find((row:any) => changed[row._id]);\r\n      const editedRow = { ...currentRow, ...changed[currentRow._id] };\r\n      let changedRows = rows.map((row) =>\r\n        changed[row._id] ? { ...row, ...changed[row._id] } : row\r\n      );\r\n      dispatch({\r\n        type: \"UPDATE_ROWS\",\r\n        payload: {\r\n          skip: requestedSkip,\r\n          rows: changedRows,\r\n        },\r\n      });\r\n      PromotionDataService.update(editedRow._id, editedRow);\r\n    }\r\n  };\r\n\r\n  const SelectActionType = () => (\r\n    <Select\r\n      onChange={onActionChange}\r\n      style={{ width: \"100%\" }}\r\n      disabled={selection.length !== 1}\r\n    >\r\n      <MenuItem value=\"edit\" onClick={() => handlePromotionEdit(selection[0])}>\r\n        Edit\r\n      </MenuItem>\r\n      <MenuItem\r\n        value=\"delete\"\r\n        onClick={() => handlePromotionDelete(selection[0])}\r\n      >\r\n        Delete\r\n      </MenuItem>\r\n      <MenuItem\r\n        value=\"duplicate\"\r\n        onClick={() => handlePromotionDuplicate(selection[0])}\r\n      >\r\n        Duplicate\r\n      </MenuItem>\r\n    </Select>\r\n  );\r\n\r\n  const SelectTypeProvider = (props: any) => {\r\n    return (\r\n      <DataTypeProvider\r\n        disabled={selection.length !== 1}\r\n        formatterComponent={SelectActionType}\r\n        {...props}\r\n      />\r\n    );\r\n  };\r\n\r\n  const loadData = () => {\r\n    const { requestedSkip, take, lastQuery, loading } = state;\r\n    const query = buildQueryString(requestedSkip, take);\r\n    if (query !== lastQuery && !loading) {\r\n      dispatch({ type: \"FETCH_INIT\" });\r\n      axios\r\n        .get(query)\r\n        .then((response) => {\r\n          console.log(response.data.promotions);\r\n          dispatch({\r\n            type: \"UPDATE_ROWS\",\r\n            payload: {\r\n              skip: requestedSkip,\r\n              rows: response.data.promotions,\r\n              totalCount: MAX_ROWS,\r\n            },\r\n          });\r\n        })\r\n        .catch(() => dispatch({ type: \"REQUEST_ERROR\" }));\r\n      dispatch({ type: \"UPDATE_QUERY\", payload: query });\r\n    }\r\n  };\r\n\r\n  useEffect(() => loadData());\r\n  const { rows, skip, totalCount, loading } = state;\r\n\r\n  return (\r\n    <Paper>\r\n      <Grid rows={rows} columns={columns} getRowId={getRowId}>\r\n        <SelectionState\r\n          selection={selection}\r\n          onSelectionChange={setSelection}\r\n        />\r\n        <EditingState\r\n          onCommitChanges={commitChanges}\r\n          columnExtensions={editingStateColumnExtensions}\r\n        />\r\n        <SelectTypeProvider\r\n          for={[\"Action\"]}\r\n          rowComponent\r\n          row={RowDetailState}\r\n        />\r\n\r\n        <DateTypeProvider for={dateColumns} />\r\n\r\n        <VirtualTableState\r\n          infiniteScrolling\r\n          loading={loading}\r\n          totalRowCount={totalCount}\r\n          pageSize={VIRTUAL_PAGE_SIZE}\r\n          skip={skip}\r\n          getRows={getRemoteRows}\r\n        />\r\n        <VirtualTable columnExtensions={tableColumnExtensions} />\r\n        <TableSelection highlightRow={true} />\r\n        <TableHeaderRow />\r\n        {editPromotion && (\r\n          <PromotionEditModal\r\n            promotion={editPromotion}\r\n            handleCloseEditModal={handleCloseEditModal}\r\n            open={openEditModal}\r\n            handleUpdatePromotion={handleUpdatePromotion}\r\n          />\r\n        )}\r\n        <TableEditRow />\r\n\r\n        <TableEditColumn showAddCommand showEditCommand />\r\n      </Grid>\r\n    </Paper>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}